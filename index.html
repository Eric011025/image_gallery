<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Image Gallery</h1>
            <button class="btn btn-primary" id="refreshButton">Refresh Images</button>
        </div>
        <div class="row" id="gallery"></div>
    </div>

    <script>
        const API_URL = "http://127.0.0.1:2998/image";

        async function fetchImages() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error fetching images:', error);
                return [];
            }
        }

        function buildImageCard(imageData) {
            const card = document.createElement('div');
            card.className = 'card mb-4 shadow-sm';
            card.style.width = '18rem';

            const preview = document.createElement('img');
            preview.className = 'card-img-top';
            preview.src = imageData.url; // 변경된 부분
            preview.addEventListener('click', () => {
                document.getElementById('largeImage').src = imageData.url; // 변경된 부분
                const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
                imageModal.show();
            });
            card.appendChild(preview);

            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';

            const modifyTime = document.createElement('p');
            modifyTime.className = 'card-text';
            modifyTime.textContent = `Modified: ${imageData.modify_time}`; // 변경된 부분
            cardBody.appendChild(modifyTime);

            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'btn btn-primary';
            downloadBtn.textContent = 'Download';
            downloadBtn.addEventListener('click', () => {
                window.open(imageData.url, '_blank'); // 변경된 부분
            });
            cardBody.appendChild(downloadBtn);

            card.appendChild(cardBody);

            return card;
        }


        function displayImages(images) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            images.forEach(imageData => {
                const imageCard = buildImageCard(imageData);
                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.appendChild(imageCard);
                gallery.appendChild(col);
            });
        }

        async function refreshImages() {
            const images = await fetchImages();
            displayImages(images);
        }

        document.getElementById('refreshButton').addEventListener('click', refreshImages);

        refreshImages();
    </script>
</body>

</html>